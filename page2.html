<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã¡ã„ã‹ã‚ã‚®ãƒ£ãƒ©ãƒªãƒ¼</title>

  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: linear-gradient(#cce7ff, #ffffff);
      min-height: 100vh;
    }

    #back-btn {
      display: inline-block;
      margin-bottom: 20px;
      padding: 8px 14px;
      background: #eee;
      border: 1px solid #aaa;
      cursor: pointer;
    }

    #form-area {
      display: none;
      margin-bottom: 20px;
    }

    .card {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 20px;
      width: 250px;
      background: white;
      border-radius: 8px;
    }

    .card img {
      width: 100%;
      border-radius: 6px;
    }

    .like-btn {
      background: #ffdddd;
      border: 1px solid #ffaaaa;
      padding: 5px 10px;
      cursor: pointer;
      margin-right: 10px;
    }

    .delete-btn {
      background: #ddd;
      border: 1px solid #aaa;
      padding: 5px 10px;
      cursor: pointer;
    }

    #gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    #viewerModal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.6); z-index: 9999; padding: 20px; }
    #viewerContent { background: #fff; max-width: 1100px; width: 100%; max-height: 90vh; overflow: auto; border-radius: 10px; padding: 16px; box-sizing: border-box; }
    #viewerImage { display: block; max-width: 100%; height: auto; margin: 0 auto 12px auto; border-radius: 6px; }

    .sheet-controls { display:flex; gap:8px; margin-bottom:8px; flex-wrap:wrap; }
    .sheet-controls button { padding:6px 10px; cursor:pointer; }

    #sheetWrap { overflow:auto; border:1px solid #ddd; border-radius:6px; padding:8px; background:#fafafa; }
    table.sheet { border-collapse: collapse; width: max-content; min-width:100%; table-layout: auto; }
    table.sheet td, table.sheet th { border:1px solid #ddd; padding:6px 8px; min-width:40px; white-space:nowrap; vertical-align: middle; }
    table.sheet td { background:#fff; }
    table.sheet th[contenteditable="true"]:focus, table.sheet td[contenteditable="true"]:focus { outline:2px solid #9ad; }

    .viewer-footer { display:flex; justify-content:space-between; margin-top:12px; gap:8px; flex-wrap:wrap; }
    .viewer-footer button { padding:8px 12px; cursor:pointer; }

    @media (max-width:600px) {
      #viewerContent { padding:10px; }
      .sheet-controls { gap:6px; }
    }
  </style>
</head>

<body>

  <button id="back-btn" onclick="location.href='index.html'">â† ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</button>

  <h1>ã¡ã„ã‹ã‚ã‚®ãƒ£ãƒ©ãƒªãƒ¼</h1>

  <button onclick="toggleForm()">æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã</button>

  <div id="form-area">
    <p>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ï¼š</p>
    <input type="file" id="imageFile" />

    <p>èª¬æ˜ï¼š</p>
    <input type="text" id="desc" />

    <br><br>
    <button onclick="uploadItem()">æŠ•ç¨¿ã™ã‚‹</button>
  </div>

  <div id="gallery"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Supabase client
    const client = supabase.createClient(
      "https://ygwqpkeopbhztcgzkqke.supabase.co",
      "sb_publishable_yXUDCLKJxQKuMvt1LnDMSg_s8mLrrux"
    );

    // viewerState global (holds current item, sheetData, and channel)
    const viewerState = { currentItem: null, sheetData: null, sheetChannel: null };

    let userId = localStorage.getItem("user_id");
    if (!userId) {
      userId = crypto.randomUUID();
      localStorage.setItem("user_id", userId);
    }

    function toggleForm() {
      const area = document.getElementById("form-area");
      area.style.display = area.style.display === "none" ? "block" : "none";
    }

    async function uploadItem() {
      const file = document.getElementById("imageFile").files[0];
      const desc = document.getElementById("desc").value;

      if (!file) {
        alert("Please select an image");
        return;
      }

      const safeName = file.name.replace(/[^a-zA-Z0-9.\-_]/g, "_");
      const fileName = `${Date.now()}-${safeName}`;

      const { error: imgErr } = await client.storage
        .from("chiikawa-images")
        .upload(fileName, file);

      if (imgErr) {
        alert("Upload failed");
        return;
      }

      const { data: publicUrl } = client.storage
        .from("chiikawa-images")
        .getPublicUrl(fileName);

      const { error: dbErr } = await client
        .from("items")
        .insert([{ image_url: publicUrl.publicUrl, description: desc, gallery: "page2" }]);

      if (dbErr) {
        alert("Save failed");
        return;
      }

      alert("Posted");
      loadItems();
    }

    async function loadItems() {
      const gallery = document.getElementById("gallery");
      gallery.innerHTML = "";

      const { data: items, error: itemsErr } = await client
        .from("items")
        .select("*")
        .eq("gallery", "page2")
        .order("created_at", { ascending: false });

      if (itemsErr || !items) {
        return;
      }

      for (const item of items) {
        const { data: liked, error: likeErr } = await client
          .from("likes")
          .select("*")
          .eq("item_id", item.id)
          .eq("user_id", userId);

        const isLiked = !likeErr && Array.isArray(liked) && liked.length > 0;

        const div = document.createElement("div");
        div.className = "card";

        div.innerHTML = `
          <img src="${item.image_url}" style="cursor:pointer" onclick='openViewer(${JSON.stringify(item)})' />
          <p>${item.description || ""}</p>
          <button class="like-btn" onclick="toggleLike(${item.id})">
            ${isLiked ? "ğŸ’–" : "ğŸ¤"} ${item.likes ?? 0}
          </button>
          <button class="delete-btn" onclick="deleteItem(${item.id})">
            å‰Šé™¤
          </button>
        `;

        gallery.appendChild(div);
      }
    }

    async function toggleLike(itemId) {
      try {
        const check = await client
          .from("likes")
          .select("*")
          .eq("item_id", itemId)
          .eq("user_id", userId);

        if (check.error) {
          return;
        }

        const liked = Array.isArray(check.data) && check.data.length > 0;

        if (liked) {
          const del = await client
            .from("likes")
            .delete()
            .eq("item_id", itemId)
            .eq("user_id", userId);

          if (del.error) {
            return;
          }
        } else {
          const ins = await client
            .from("likes")
            .insert([{ item_id: itemId, user_id: userId }]);

          if (ins.error) {
            return;
          }
        }

        const cnt = await client
          .from("likes")
          .select("*", { count: "exact", head: true })
          .eq("item_id", itemId);

        if (!cnt.error) {
          const newCount = cnt.count ?? 0;
          await client
            .from("items")
            .update({ likes: newCount })
            .eq("id", itemId);
        }

        await loadItems();
      } catch (e) {
        // silent
      }
    }

    async function deleteItem(id) {
      const pass = prompt("Enter delete password");

      if (pass !== "pass") {
        alert("Incorrect password");
        return;
      }

      await client.from("items").delete().eq("id", id);
      alert("Deleted");
      loadItems();
    }

    loadItems();

    /* ---------- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: ãƒ†ã‚­ã‚¹ãƒˆå¹…æ¸¬å®š ---------- */
    function measureTextWidth(text, font = "14px sans-serif") {
      const ctx = measureTextWidth._ctx || (measureTextWidth._ctx = document.createElement("canvas").getContext("2d"));
      ctx.font = font;
      return ctx.measureText(String(text)).width;
    }

    /* ---------- ãƒ¢ãƒ¼ãƒ€ãƒ«è¦ç´ ï¼ˆHTMLã¯ä¸‹ã«ã‚ã‚‹ï¼‰ ---------- */

    /* ---------- debounce ã¨ã‚µãƒ¼ãƒãƒ¼ä¿å­˜ï¼ˆupsertï¼‰ ---------- */
    function debounce(fn, wait = 600) {
      let t;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn(...args), wait);
      };
    }

    async function saveSheetToServer() {
      const item = viewerState.currentItem;
      if (!item) { updateStatus("ä¿å­˜ã§ãã¾ã›ã‚“: ã‚¢ã‚¤ãƒ†ãƒ æœªé¸æŠ"); return; }

      // æ›´æ–°æ™‚åˆ»ã‚’ä»˜ä¸
      viewerState.sheetData.updated_at = new Date().toISOString();

      const payload = {
        item_id: item.id,
        sheet: viewerState.sheetData,
        updated_at: viewerState.sheetData.updated_at
      };

      const { data, error } = await client
        .from("item_sheets")
        .upsert(payload, { returning: "representation" });

      if (error) {
        console.error("upsert error", error);
        updateStatus("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ");
        return;
      }

      // localStorage ã‚‚æ›´æ–°ã—ã¦ãŠãï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼‰
      localStorage.setItem(`sheet_item_${item.id}`, JSON.stringify(viewerState.sheetData));
      updateStatus("ã‚µãƒ¼ãƒãƒ¼ã«ä¿å­˜ã—ã¾ã—ãŸ");
    }

    const debouncedSave = debounce(saveSheetToServer, 700);

    /* ---------- Realtime è³¼èª­ï¼ˆstart / stopï¼‰ ---------- */
    async function startSheetSubscription(item) {
      // æ—¢å­˜è³¼èª­ãŒã‚ã‚Œã°è§£é™¤
      if (viewerState.sheetChannel) {
        try { await viewerState.sheetChannel.unsubscribe(); } catch(e){ console.warn(e); }
        viewerState.sheetChannel = null;
      }

      const channelName = `sheet-${item.id}`;
      const channel = client
        .channel(channelName)
        .on(
          "postgres_changes",
          { event: "*", schema: "public", table: "item_sheets", filter: `item_id=eq.${item.id}` },
          (payload) => {
            if (payload.eventType === "INSERT" || payload.eventType === "UPDATE") {
              if (payload.new && payload.new.sheet) {
                const remoteTs = payload.new.updated_at ? new Date(payload.new.updated_at).getTime() : 0;
                const localTs = viewerState.sheetData?.updated_at ? new Date(viewerState.sheetData.updated_at).getTime() : 0;
                if (remoteTs <= localTs) return;
                try {
                  viewerState.sheetData = payload.new.sheet;
                  renderSheet();
                  updateStatus("ä»–ç«¯æœ«ã®å¤‰æ›´ã‚’å—ä¿¡ã—ã¾ã—ãŸ");
                } catch (e) {
                  console.error("å—ä¿¡ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¨ãƒ©ãƒ¼", e);
                }
              }
            } else if (payload.eventType === "DELETE") {
              viewerState.sheetData = { id: item.id, cols: 1, rows: [[""]], colHeaders: ["A"], rowHeaders: ["1"] };
              renderSheet();
              updateStatus("ã‚·ãƒ¼ãƒˆãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ");
            }
          }
        );

      await channel.subscribe();
      viewerState.sheetChannel = channel;
    }

    async function stopSheetSubscription() {
      if (viewerState.sheetChannel) {
        try { await viewerState.sheetChannel.unsubscribe(); } catch (e) { console.warn(e); }
        viewerState.sheetChannel = null;
      }
      viewerState.currentItem = null;
      viewerState.sheetData = null;
    }

    /* ---------- ãƒ¢ãƒ¼ãƒ€ãƒ«æ“ä½œï¼ˆopenViewer / close / saveï¼‰ ---------- */
    async function openViewer(item) {
      // æ—¢å­˜çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰é–‹å§‹
      viewerState.currentItem = null;
      viewerState.sheetData = null;

      viewerState.currentItem = item;

      // ç”»åƒè¡¨ç¤º
      const img = document.getElementById("viewerImage");
      img.src = item.image_url;

      // ãƒ¡ã‚¿æƒ…å ±
      document.getElementById("metaInfo").textContent = `ID: ${item.id}  èª¬æ˜: ${item.description || ""}`;

      // ç”»åƒã”ã¨ã®ã‚­ãƒ¼ã§èª­ã¿è¾¼ã‚€ï¼ˆlocalStorage å„ªå…ˆï¼‰
      const key = `sheet_item_${item.id}`;
      const saved = localStorage.getItem(key);
      if (saved) {
        try {
          viewerState.sheetData = JSON.parse(saved);
        } catch (e) {
          viewerState.sheetData = null;
        }
      }

      // ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒãªã‘ã‚Œã°æ–°è¦åˆæœŸåŒ–ï¼ˆ3x3ï¼‰
      if (!viewerState.sheetData) {
        const rows = [["", "", ""], ["", "", ""], ["", "", ""]];
        const cols = 3;
        const colHeaders = Array.from({ length: cols }, (_, i) => String.fromCharCode(65 + i));
        const rowHeaders = Array.from({ length: rows.length }, (_, i) => String(i + 1));
        viewerState.sheetData = { id: item.id, rows, cols, colHeaders, rowHeaders };
      }

      renderSheet();
      document.getElementById("viewerModal").style.display = "flex";
      document.getElementById("viewerModal").setAttribute("aria-hidden", "false");

      // è³¼èª­é–‹å§‹ï¼ˆRealtimeï¼‰
      await startSheetSubscription(item);
    }

    // ä¿å­˜ãƒœã‚¿ãƒ³ï¼ˆã‚µãƒ¼ãƒãƒ¼ä¿å­˜ã«ç´ã¥ã‘ï¼‰
    document.getElementById("saveSheetBtn").addEventListener("click", debouncedSave);

    // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ï¼ˆè³¼èª­è§£é™¤ã—ã¦çŠ¶æ…‹ã‚¯ãƒªã‚¢ï¼‰
    document.getElementById("closeViewerBtn").addEventListener("click", async () => {
      document.getElementById("viewerModal").style.display = "none";
      document.getElementById("viewerModal").setAttribute("aria-hidden", "true");
      await stopSheetSubscription();
    });

    // Esc ã§é–‰ã˜ã‚‹
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        const modal = document.getElementById("viewerModal");
        if (modal.style.display === "flex") {
          modal.style.display = "none";
          modal.setAttribute("aria-hidden", "true");
          stopSheetSubscription();
        }
      }
    });

    /* ---------- ã‚·ãƒ¼ãƒˆæç”»ã¨ç·¨é›† ---------- */
    function renderSheet() {
      const table = document.getElementById("sheetTable");
      table.innerHTML = "";
      const data = viewerState.sheetData;
      if (!data) return;

      // thead
      const thead = document.createElement("thead");
      const headRow = document.createElement("tr");
      const corner = document.createElement("th");
      corner.textContent = "";
      headRow.appendChild(corner);

      for (let c = 0; c < data.cols; c++) {
        const th = document.createElement("th");
        th.contentEditable = "true";
        th.dataset.c = c;
        th.className = "col-header";
        th.textContent = data.colHeaders && data.colHeaders[c] != null ? data.colHeaders[c] : String.fromCharCode(65 + (c % 26));
        th.addEventListener("input", onColHeaderInput);
        headRow.appendChild(th);
      }
      thead.appendChild(headRow);
      table.appendChild(thead);

      // tbody
      const tbody = document.createElement("tbody");
      for (let r = 0; r < data.rows.length; r++) {
        const tr = document.createElement("tr");
        const rowHeader = document.createElement("th");
        rowHeader.contentEditable = "true";
        rowHeader.dataset.r = r;
        rowHeader.className = "row-header";
        rowHeader.textContent = data.rowHeaders && data.rowHeaders[r] != null ? data.rowHeaders[r] : String(r+1);
        rowHeader.addEventListener("input", onRowHeaderInput);
        tr.appendChild(rowHeader);

        for (let c = 0; c < data.cols; c++) {
          const td = document.createElement("td");
          td.contentEditable = "true";
          td.dataset.r = r;
          td.dataset.c = c;
          td.textContent = (data.rows[r] && data.rows[r][c] != null) ? data.rows[r][c] : "";
          td.addEventListener("input", onCellInput);
          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }
      table.appendChild(tbody);

      autoSizeColumns();
      updateStatus("ç·¨é›†å¯èƒ½");
    }

    function onCellInput(e) {
      const td = e.target;
      const r = Number(td.dataset.r);
      const c = Number(td.dataset.c);
      const val = td.textContent;
      const data = viewerState.sheetData;
      if (!data.rows[r]) data.rows[r] = [];
      data.rows[r][c] = val;
      autoSizeColumns();
    }

    function onColHeaderInput(e) {
      const th = e.target;
      const c = Number(th.dataset.c);
      const val = th.textContent;
      const data = viewerState.sheetData;
      data.colHeaders = data.colHeaders || [];
      data.colHeaders[c] = val;
      autoSizeColumns();
    }

    function onRowHeaderInput(e) {
      const th = e.target;
      const r = Number(th.dataset.r);
      const val = th.textContent;
      const data = viewerState.sheetData;
      data.rowHeaders = data.rowHeaders || [];
      data.rowHeaders[r] = val;
    }

    function autoSizeColumns() {
      const table = document.getElementById("sheetTable");
      const data = viewerState.sheetData;
      if (!data) return;

      const maxColWidth = 300; // åˆ—å¹…ã®ä¸Šé™ï¼ˆpxï¼‰
      const minColWidth = 40;
      const colWidths = new Array(data.cols).fill(minColWidth);

      // ãƒ˜ãƒƒãƒ€å¹…
      for (let c = 0; c < data.cols; c++) {
        const header = (data.colHeaders && data.colHeaders[c]) ? data.colHeaders[c] : String.fromCharCode(65 + (c % 26));
        colWidths[c] = Math.max(colWidths[c], measureTextWidth(header) + 24);
      }

      // ã‚»ãƒ«å¹…
      for (let r = 0; r < data.rows.length; r++) {
        for (let c = 0; c < data.cols; c++) {
          const v = (data.rows[r] && data.rows[r][c] != null) ? String(data.rows[r][c]) : "";
          const w = measureTextWidth(v) + 24;
          if (w > colWidths[c]) colWidths[c] = w;
        }
      }

      // ä¸Šé™ã‚’é©ç”¨
      for (let c = 0; c < colWidths.length; c++) {
        if (colWidths[c] > maxColWidth) colWidths[c] = maxColWidth;
      }

      // colgroup ã‚’ä½œã‚‹
      let colgroup = table.querySelector("colgroup");
      if (colgroup) colgroup.remove();
      colgroup = document.createElement("colgroup");
      for (let c = 0; c < data.cols; c++) {
        const col = document.createElement("col");
        col.style.width = colWidths[c] + "px";
        colgroup.appendChild(col);
      }
      table.insertBefore(colgroup, table.firstChild);

      // ãƒ†ãƒ¼ãƒ–ãƒ«å…¨ä½“å¹…ã‚’è¨­å®šï¼ˆåˆè¨ˆå¹…ï¼‰ã€‚ã“ã‚Œã§æœ€å¾Œã®åˆ—ãŒå‹æ‰‹ã«ä¼¸ã³ã‚‹ã®ã‚’é˜²ãã€‚
      const total = colWidths.reduce((a,b)=>a+b, 0) + 60; // ä½™ç™½åˆ†
      table.style.width = total + "px";
    }

    // è¡Œè¿½åŠ 
    document.getElementById("addRowBtn").addEventListener("click", () => {
      const data = viewerState.sheetData;
      const newRow = new Array(data.cols).fill("");
      data.rows.push(newRow);
      data.rowHeaders = data.rowHeaders || [];
      data.rowHeaders.push(String(data.rows.length));
      renderSheet();
    });

    // è¡Œå‰Šé™¤
    document.getElementById("delRowBtn").addEventListener("click", () => {
      const data = viewerState.sheetData;
      if (data.rows.length <= 1) { updateStatus("è¡Œã¯æœ€ä½1è¡Œå¿…è¦ã§ã™"); return; }
      data.rows.pop();
      data.rowHeaders.pop();
      renderSheet();
    });

    // åˆ—è¿½åŠ 
    document.getElementById("addColBtn").addEventListener("click", () => {
      const data = viewerState.sheetData;
      data.cols = (data.cols || 0) + 1;
      for (let r = 0; r < data.rows.length; r++) {
        data.rows[r] = data.rows[r] || [];
        data.rows[r].push("");
      }
      data.colHeaders = data.colHeaders || [];
      data.colHeaders.push(String.fromCharCode(65 + ((data.cols-1) % 26)));
      renderSheet();
    });

    // åˆ—å‰Šé™¤
    document.getElementById("delColBtn").addEventListener("click", () => {
      const data = viewerState.sheetData;
      if (data.cols <= 1) { updateStatus("åˆ—ã¯æœ€ä½1åˆ—å¿…è¦ã§ã™"); return; }
      data.cols = data.cols - 1;
      for (let r = 0; r < data.rows.length; r++) {
        if (Array.isArray(data.rows[r])) data.rows[r].splice(-1,1);
      }
      if (data.colHeaders) data.colHeaders.splice(-1,1);
      renderSheet();
    });

    // è‡ªå‹•ã‚µã‚¤ã‚ºãƒœã‚¿ãƒ³
    document.getElementById("autoSizeBtn").addEventListener("click", autoSizeColumns);

    // ä¿å­˜ï¼ˆlocalStorage ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯æ®‹ã™ãŒã€å®Ÿéš›ã®ä¿å­˜ã¯ debouncedSaveï¼‰
    document.getElementById("saveSheetBtn").addEventListener("click", () => {
      // debouncedSave ãŒæ—¢ã«ç´ã¥ã„ã¦ã„ã‚‹ãŒã€ã“ã“ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ local ä¿å­˜ã‚‚è¡Œã†
      const item = viewerState.currentItem;
      if (!item) return;
      const key = `sheet_item_${item.id}`;
      localStorage.setItem(key, JSON.stringify(viewerState.sheetData));
      updateStatus("ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸï¼ˆã‚µãƒ¼ãƒãƒ¼ä¿å­˜ã¯ãƒœã‚¿ãƒ³ã§å®Ÿè¡Œï¼‰");
    });

    function updateStatus(text) {
      document.getElementById("sheetStatus").textContent = text;
    }
  </script>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«è¦ç´ ï¼ˆHTMLï¼‰ -->
  <div id="viewerModal" aria-hidden="true">
    <div id="viewerContent" role="dialog" aria-modal="true">
      <img id="viewerImage" src="" alt="preview" />
      <div class="sheet-controls">
        <button id="addRowBtn">è¡Œã‚’è¿½åŠ </button>
        <button id="delRowBtn">è¡Œã‚’å‰Šé™¤</button>
        <button id="addColBtn">åˆ—ã‚’è¿½åŠ </button>
        <button id="delColBtn">åˆ—ã‚’å‰Šé™¤</button>
        <button id="autoSizeBtn">åˆ—å¹…è‡ªå‹•èª¿æ•´</button>
        <button id="saveSheetBtn">ä¿å­˜</button>
        <button id="closeViewerBtn" style="margin-left:auto">é–‰ã˜ã‚‹</button>
      </div>
      <div id="sheetWrap">
        <table id="sheetTable" class="sheet"></table>
      </div>
      <div class="viewer-footer">
        <div id="metaInfo"></div>
        <div id="sheetStatus"></div>
      </div>
    </div>
  </div>

</body>
</html>
